{"ast":null,"code":"var _jsxFileName = \"/Users/hantaoliu/Projects/Learning-Platform/techleak/client/src/components/Login.jsx\";\nimport React, { Component } from \"react\";\nimport axios from \"../axios/axios-blogs\";\nimport Modal from \"react-responsive-modal\";\nimport Spinner from \"./UI/Spinner/Spinner\";\nimport { Link } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\n\nclass Login extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      password: \"\",\n      email: \"\",\n      username: \"\",\n      loading: false\n    };\n\n    this.handleChange = (e, type) => {\n      if (type === \"email\" || type === \"password\") {\n        this.setState({\n          notMatched: false\n        });\n      }\n\n      this.setState({\n        [type]: e.target.value\n      });\n    };\n\n    this.handleResetPassword = () => {\n      this.props.onSwitchLoginModal();\n    };\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      this.setState({\n        loading: true\n      });\n      const _this$state = this.state,\n            email = _this$state.email,\n            password = _this$state.password;\n      const user = {\n        user: {\n          email: email,\n          password: password\n        }\n      };\n\n      try {\n        let res = await axios.post(\"/api/users/login\", user, {\n          headers: \"\"\n        });\n        let data = res.data; // asyn function that retrieve all details about likedPosts and myPosts\n\n        let allPostDetail = await this.fetchAllPostDetails(data);\n        let likedPostsDetail = allPostDetail[0];\n        let myPostsDetail = allPostDetail[1];\n        this.setState({\n          loading: false,\n          email: \"\",\n          password: \"\"\n        }); //remove memeory likes first then add back in\n\n        this.props.handleLogIn(data.username, data.id, data.likedPosts, data.myPosts, data.avatar, data.bio, likedPostsDetail, myPostsDetail); //close modal\n\n        this.props.onSwitchLoginModal(); //save tokens\n\n        localStorage.setItem(\"token\", res.data.token);\n      } catch (err) {\n        //Here we pass in status code into error, and we handle\n        //error codes by err.response\n        console.log(err);\n        this.setState({\n          loading: false,\n          errStatus: err.response.status\n        });\n      }\n    };\n\n    this.fetchAllPostDetails = async data => {\n      const likedPosts = data.likedPosts.reverse();\n      const myPosts = data.myPosts.reverse();\n      let singleLikedPostDetailPromise = [];\n      let singleMyPostDetailPromise = [];\n\n      try {\n        for (var i = 0; i < likedPosts.length; i++) {\n          let l_promise = this.fetchSinglePostDetail(likedPosts[i]);\n          singleLikedPostDetailPromise.unshift(l_promise);\n        }\n\n        for (var j = 0; j < myPosts.length; j++) {\n          let m_promise = this.fetchSinglePostDetail(myPosts[j]);\n          singleMyPostDetailPromise.unshift(m_promise);\n        }\n\n        let allLikedPostDetails = Promise.all(singleLikedPostDetailPromise);\n        let allmyPostDetails = Promise.all(singleMyPostDetailPromise);\n        let allPostDetails = await Promise.all([allLikedPostDetails, allmyPostDetails]);\n        return allPostDetails;\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    this.fetchSinglePostDetail = async postID => {\n      try {\n        let userDetail = await axios.get(\"/api/posts/\".concat(postID), {\n          headers: \"\"\n        });\n        let userData = userDetail.data;\n        userData.deleted = false;\n        return userData;\n      } catch (error) {\n        return {\n          _id: postID,\n          deleted: true\n        };\n      }\n    };\n  }\n\n  render() {\n    const modalBg = {\n      modal: {\n        borderRadius: \"10%\"\n      }\n    };\n\n    const userError = () => {\n      let body; //handles different error\n\n      switch (this.state.errStatus) {\n        case 458:\n          body = \"Account does not exist\";\n          break;\n\n        case 468:\n          body = \"Email and password not matched\";\n          break;\n\n        case 478:\n          body = \"Email has not been verified\";\n          break;\n\n        default:\n          break;\n      }\n\n      return React.createElement(\"p\", {\n        className: \"help is-danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, \" \", body);\n    };\n\n    let login = React.createElement(\"div\", {\n      style: {\n        padding: \"4%\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"field\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      className: \"label\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, \"Email\"), React.createElement(\"div\", {\n      className: \"control has-icons-left has-icons-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      className: \"input is-primary\",\n      type: \"email\",\n      placeholder: \"Your Email\",\n      required: true,\n      onChange: e => this.handleChange(e, \"email\"),\n      value: this.state.email,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"icon is-small is-left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"fas fa-envelope\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      className: \"field\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      className: \"label\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, \"Password\"), React.createElement(\"div\", {\n      className: \"control has-icons-left has-icons-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      className: \"input is-primary\",\n      type: \"password\",\n      placeholder: \"Your Password\",\n      minLength: \"8\",\n      maxLength: \"20\",\n      size: \"30\",\n      required: true,\n      onChange: e => this.handleChange(e, \"password\"),\n      value: this.state.password,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"icon is-small is-left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"fas fa-key\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    })))), userError(), React.createElement(\"div\", {\n      className: \"forgetPwd\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"button\",\n      className: \"button is-small is-light\",\n      onClick: this.handleResetPassword,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/reset-password\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }, \"Forget Password?\")))), React.createElement(\"div\", {\n      className: \"field is-grouped\",\n      style: {\n        justifyContent: \"center\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"control\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"submit\",\n      className: \"button is-primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, \"Login\")))));\n\n    if (this.state.loading) {\n      login = React.createElement(\"div\", {\n        style: {\n          textAlign: \"center\",\n          paddingTop: \"25%\",\n          paddingBottom: \"25%\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(Spinner, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }));\n    }\n\n    return React.createElement(Modal, {\n      className: \"modal-lg\",\n      open: this.props.loginOpen,\n      onClose: this.props.onSwitchLoginModal,\n      center: true,\n      styles: modalBg,\n      showCloseIcon: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221\n      },\n      __self: this\n    }, login);\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    loginOpen: state.persistedReducer.loginOpen\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    handleLogIn: (username, userID, likedPosts, myPosts, avatar, bio, likedPostsDetail, myPostsDetail) => dispatch({\n      type: \"LOGIN\",\n      username: username,\n      userID: userID,\n      likedPosts: likedPosts,\n      myPosts: myPosts,\n      avatar: avatar,\n      bio: bio,\n      likedPostsDetail: likedPostsDetail,\n      myPostsDetail: myPostsDetail\n    }),\n    onSwitchLoginModal: () => dispatch({\n      type: \"LOGINMODAL\"\n    }),\n    removeLikes: () => dispatch({\n      type: \"REMOVELIKES\"\n    })\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Login);","map":{"version":3,"sources":["/Users/hantaoliu/Projects/Learning-Platform/techleak/client/src/components/Login.jsx"],"names":["React","Component","axios","Modal","Spinner","Link","connect","Login","state","password","email","username","loading","handleChange","e","type","setState","notMatched","target","value","handleResetPassword","props","onSwitchLoginModal","handleSubmit","preventDefault","user","res","post","headers","data","allPostDetail","fetchAllPostDetails","likedPostsDetail","myPostsDetail","handleLogIn","id","likedPosts","myPosts","avatar","bio","localStorage","setItem","token","err","console","log","errStatus","response","status","reverse","singleLikedPostDetailPromise","singleMyPostDetailPromise","i","length","l_promise","fetchSinglePostDetail","unshift","j","m_promise","allLikedPostDetails","Promise","all","allmyPostDetails","allPostDetails","error","postID","userDetail","get","userData","deleted","_id","render","modalBg","modal","borderRadius","userError","body","login","padding","justifyContent","textAlign","paddingTop","paddingBottom","loginOpen","mapStateToProps","persistedReducer","mapDispatchToProps","dispatch","userID","removeLikes"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport axios from \"../axios/axios-blogs\";\nimport Modal from \"react-responsive-modal\";\nimport Spinner from \"./UI/Spinner/Spinner\";\nimport { Link } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\n\nclass Login extends Component {\n  state = {\n    password: \"\",\n    email: \"\",\n    username: \"\",\n    loading: false\n  };\n\n  handleChange = (e, type) => {\n    if (type === \"email\" || type === \"password\") {\n      this.setState({ notMatched: false });\n    }\n    this.setState({ [type]: e.target.value });\n  };\n\n  handleResetPassword = () => {\n    this.props.onSwitchLoginModal();\n  };\n\n  handleSubmit = async e => {\n    e.preventDefault();\n\n    this.setState({ loading: true });\n    const { email, password } = this.state;\n    const user = {\n      user: {\n        email: email,\n        password: password\n      }\n    };\n\n    try {\n      let res = await axios.post(\"/api/users/login\", user, { headers: \"\" });\n      let data = res.data;\n      // asyn function that retrieve all details about likedPosts and myPosts\n      let allPostDetail = await this.fetchAllPostDetails(data);\n      let likedPostsDetail = allPostDetail[0];\n      let myPostsDetail = allPostDetail[1];\n      this.setState({ loading: false, email: \"\", password: \"\" });\n      //remove memeory likes first then add back in\n      this.props.handleLogIn(\n        data.username,\n        data.id,\n        data.likedPosts,\n        data.myPosts,\n        data.avatar,\n        data.bio,\n        likedPostsDetail,\n        myPostsDetail\n      );\n      //close modal\n      this.props.onSwitchLoginModal();\n      //save tokens\n      localStorage.setItem(\"token\", res.data.token);\n    } catch (err) {\n      //Here we pass in status code into error, and we handle\n      //error codes by err.response\n      console.log(err);\n      this.setState({\n        loading: false,\n        errStatus: err.response.status\n      });\n    }\n  };\n\n  // responsible for fetching data about my posts and liked posts from\n  // the database. the output is later used for setting states in redux\n  fetchAllPostDetails = async data => {\n    const likedPosts = data.likedPosts.reverse();\n    const myPosts = data.myPosts.reverse();\n    let singleLikedPostDetailPromise = [];\n    let singleMyPostDetailPromise = [];\n    try {\n      for (var i = 0; i < likedPosts.length; i++) {\n        let l_promise = this.fetchSinglePostDetail(likedPosts[i]);\n        singleLikedPostDetailPromise.unshift(l_promise);\n      }\n      for (var j = 0; j < myPosts.length; j++) {\n        let m_promise = this.fetchSinglePostDetail(myPosts[j]);\n        singleMyPostDetailPromise.unshift(m_promise);\n      }\n      let allLikedPostDetails = Promise.all(singleLikedPostDetailPromise);\n      let allmyPostDetails = Promise.all(singleMyPostDetailPromise);\n      let allPostDetails = await Promise.all([\n        allLikedPostDetails,\n        allmyPostDetails\n      ]);\n      return allPostDetails;\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  fetchSinglePostDetail = async postID => {\n    try {\n      let userDetail = await axios.get(`/api/posts/${postID}`, { headers: \"\" });\n      let userData = userDetail.data;\n      userData.deleted = false;\n      return userData;\n    } catch (error) {\n      return {\n        _id: postID,\n        deleted: true\n      };\n    }\n  };\n\n  render() {\n    const modalBg = {\n      modal: {\n        borderRadius: \"10%\"\n      }\n    };\n\n    const userError = () => {\n      let body;\n\n      //handles different error\n      switch (this.state.errStatus) {\n        case 458:\n          body = \"Account does not exist\";\n          break;\n        case 468:\n          body = \"Email and password not matched\";\n          break;\n        case 478:\n          body = \"Email has not been verified\";\n          break;\n        default:\n          break;\n      }\n      return <p className=\"help is-danger\"> {body}</p>;\n    };\n\n    let login = (\n      <div style={{ padding: \"4%\" }}>\n        <form onSubmit={this.handleSubmit}>\n          <div className=\"field\">\n            <label className=\"label\">Email</label>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input\n                className=\"input is-primary\"\n                type=\"email\"\n                placeholder=\"Your Email\"\n                required\n                onChange={e => this.handleChange(e, \"email\")}\n                value={this.state.email}\n              />\n\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-envelope\" />\n              </span>\n            </div>\n          </div>\n\n          <div className=\"field\">\n            <label className=\"label\">Password</label>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input\n                className=\"input is-primary\"\n                type=\"password\"\n                placeholder=\"Your Password\"\n                minLength=\"8\"\n                maxLength=\"20\"\n                size=\"30\"\n                required\n                onChange={e => this.handleChange(e, \"password\")}\n                value={this.state.password}\n              />\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-key\" />\n              </span>\n            </div>\n          </div>\n          {userError()}\n          <div className=\"forgetPwd\">\n            <button\n              type=\"button\"\n              className=\"button is-small is-light\"\n              onClick={this.handleResetPassword}\n            >\n              <Link to=\"/reset-password\">\n                <p>Forget Password?</p>\n              </Link>\n            </button>\n          </div>\n          <div\n            className=\"field is-grouped\"\n            style={{ justifyContent: \"center\" }}\n          >\n            <div className=\"control\">\n              <button type=\"submit\" className=\"button is-primary\">\n                Login\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    );\n    if (this.state.loading) {\n      login = (\n        <div\n          style={{\n            textAlign: \"center\",\n            paddingTop: \"25%\",\n            paddingBottom: \"25%\"\n          }}\n        >\n          <Spinner />\n        </div>\n      );\n    }\n    return (\n      <Modal\n        className=\"modal-lg\"\n        open={this.props.loginOpen}\n        onClose={this.props.onSwitchLoginModal}\n        center\n        styles={modalBg}\n        showCloseIcon={false}\n      >\n        {login}\n      </Modal>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    loginOpen: state.persistedReducer.loginOpen\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    handleLogIn: (\n      username,\n      userID,\n      likedPosts,\n      myPosts,\n      avatar,\n      bio,\n      likedPostsDetail,\n      myPostsDetail\n    ) =>\n      dispatch({\n        type: \"LOGIN\",\n        username: username,\n        userID: userID,\n        likedPosts: likedPosts,\n        myPosts: myPosts,\n        avatar: avatar,\n        bio: bio,\n        likedPostsDetail: likedPostsDetail,\n        myPostsDetail: myPostsDetail\n      }),\n    onSwitchLoginModal: () => dispatch({ type: \"LOGINMODAL\" }),\n    removeLikes: () => dispatch({ type: \"REMOVELIKES\" })\n  };\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Login);\n"]},"metadata":{},"sourceType":"module"}